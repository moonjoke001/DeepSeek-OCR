# 使用 vLLM 官方最新 nightly 镜像 (已包含 Flash Attention 和所有依赖)
FROM vllm/vllm-openai@sha256:f32c2d7673b8a6fdece522f5cc7de4755c35eb3a315d3ad39767e004f9cf70b0

# 设置环境变量
ENV PYTHONUNBUFFERED=1

# 安装 DeepSeek-OCR 额外依赖
RUN pip3 install --no-cache-dir \
    PyMuPDF \
    img2pdf \
    einops \
    easydict \
    addict \
    matplotlib \
    timm

# 复制 DeepSeek-OCR 自定义代码 (如果有)
# COPY DeepSeek-OCR-master/DeepSeek-OCR-vllm/ /app/

# 创建工作区目录
RUN mkdir -p /workspace/input /workspace/output /workspace/models

# 暴露端口
EXPOSE 8000

# 使用 vLLM 官方推荐的启动方式
# 模型路径将通过 docker-compose 的 command 参数指定
